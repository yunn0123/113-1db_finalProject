<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <style>
        body {
            font-family: monospace;
            background-color: #282c34;
            color: #61dafb;
            padding: 20px;
        }
        #output {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #61dafb;
            padding: 10px;
            margin-bottom: 10px;
        }
        #commandInput {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: #282c34;
            color: #61dafb;
            outline: none;
        }
    </style>
</head>
<body>
<div id="output"></div>
<input type="text" id="commandInput" placeholder="Type a command... (use /help to see commands)" autofocus>

<script>
    const outputElement = document.getElementById('output');
    const commandInput = document.getElementById('commandInput');
    let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;

    function showActions() {
        setTimeout(() => {
            let actions = '<strong>Available Actions:</strong>';

            if (!loggedInUser) {
                actions += `<div>1. register [uId] [uName] [gender] [department] [degree] [enrollYear] [grade] [enrollmentStatus] [password]</div>`;
                actions += `<div>2. login [uId] [password]</div>`;
            } else if (loggedInUser.role !== "admin") {
                actions += `<div>1. search_books [title]</div>`;
                actions += `<div>1. search_av [title]</div>`;
                actions += `<div>2. borrow_books [bookID]</div>`;
                actions += `<div>3. borrow_av [avID]</div>`;
                actions += `<div>4. view_discussion_rooms</div>`;
                actions += `<div>5. reserve_discussion_rooms [discussion_roomID] [startTime (in YYYY-MM-DD HH:MM format)] [endTime (in YYYY-MM-DD HH:MM format)]</div>`;
                actions += `<div>6. view_study_rooms</div>`;
                actions += `<div>7. view_seats [roomID]</div>`;
                actions += `<div>8. reserve_study_rooms [study_roomID] [startTime (in YYYY-MM-DD HH:MM format)] [endTime (in YYYY-MM-DD HH:MM format)]</div>`;
                actions += `<div>9. submit_wishlist [isbn/isan]</div>`;
                actions += `<div>10. view_wishlist</div>`;
                actions += `<div>11. search_active_fairs</div>`;
                actions += `</div>12. search_fair_books [fairName]</div>`;
                actions += `<div>11. logout</div>`;
            } else if (loggedInUser.role === "admin") {
                actions += `<div>1. new_fair [Fair Name] [Start Date] [End Date]</div>`;
                actions += `<div>2. new_book [title] [isbn] [edition] [publish_year] [genre] [status] [author]</div>`;
                actions += `<div>3. new_av [title] [isan] [status] [publishYear] [duration] [author]</div>`;
                actions += `<div>4. new_book_acq [acquisitionDate] [status] [isbn] [cost] [supplier]</div>`;
                actions += `<div>5. new_av_acq [acquisitionDate] [status] [isan] [cost] [supplier]</div>`;
                actions += `<div>6. update_book [title] [isbn] [edition] [publishYear] [genre] [bookID]</div>`;
                actions += `<div>7. update_av [title] [isan] [publishYear] [duration] [avID]</div>`;
                actions += `<div>8. delete_book [bookID]</div>`;
                actions += `<div>9. delete_av [avID]</div>`;
                actions += `<div>10. update_book_status [status] [bookID]</div>`;
                actions += `<div>11. update_av_status [status] [avID]</div>`;
                actions += `<div>12. return_book [bookID]</div>`;
                actions += `<div>13. return_av [avID]</div>`;
                actions += `<div>14. update_overdue_book_loans</div>`;
                actions += `<div>15. update_overdue_av_loans</div>`;
                actions += `<div>16. rating_book [rating] [book_id] [user_id]</div>`;
                actions += `<div>17. rating_av [rating] [av_id] [user_id]</div>`;
                actions += `<div>18. update_fair_start_date [fair_id] [start_date]</div>`;
                actions += `<div>19. update_fair_end_date [fair_id] [end_date]</div>`;
                actions += `<div>20. get_book_loans_by_user [user_id]</div>`;
                actions += `<div>21. get_av_loans_by_user [user_id]</div>`;
                actions += `<div>22. get_books_by_time [start_date] [end_date]</div>`;
                actions += `<div>23. get_av_by_time [start_date] [end_date]</div>`;
                actions += `<div>24. get_books_by_status [status]</div>`;
                actions += `<div>25. get_av_by_status [status]</div>`;
                actions += `<div>26. get_fixing_discussion_room</div>`;
                actions += `<div>27. get_fixing_seats</div>`;
                actions += `<div>28. update_discussion_room_status [status] [room_id]</div>`;
                actions += `<div>29. update_seat_status [status] [seat_id]</div>`;
                actions += `<div>30. logout</div>`;
            }
            appendOutput(actions, true);
        }, 500);
    }


    function appendOutput(text, isSystemMessage = false) {
        const messageClass = isSystemMessage ? "system-message" : "command-text";
        outputElement.innerHTML += `<div class="${messageClass}">${text}</div>`;
        outputElement.scrollTop = outputElement.scrollHeight;
    }

    async function processCommand(command) {
        const commandParts = command.split(' ');
        const action = commandParts[0].toLowerCase();

        switch (action) {
            case '/help':
                showActions();
                break;
            case 'register':
                if (commandParts.length !== 10) {
                    appendOutput(
                        `Usage: register [uId] [uName] [gender] [department] [degree] [enrollYear] [grade] [enrollmentStatus] [password]`
                    );
                    break;
                }
                console.log(commandParts.length);
                const [uId, uName, gender, department, degree, enrollYear, grade, enrollmentStatus, password] = commandParts.slice(1);

                if (!uId || !uName || !gender || !department || !degree || !enrollYear || !grade || !enrollmentStatus || !password) {
                    appendOutput('All fields are required for registration. Please try again.');
                    break;
                }

                try {
                    const registerResponse = await fetch('http://localhost:3000/users', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            uId,
                            uName,
                            gender,
                            department,
                            degree,
                            enrollYear,
                            grade,
                            enrollmentStatus,
                            password,
                        }),
                    }).then((res) => res.json());

                    if (registerResponse?.u_id) {
                        appendOutput(`Registration successful. User ID: ${registerResponse.u_id}`);
                    } else {
                        appendOutput(`Registration failed: ${registerResponse.error || 'Unknown error'}`);
                    }
                } catch (error) {
                    appendOutput('Error during registration. Please try again.');
                    console.error('Register Error:', error);
                }
                break;
            case 'login':
                if (commandParts.length !== 3) {
                    appendOutput('Usage: login [uId] [password]');
                    break;
                }

                userId = commandParts[1];
                loginPassword = commandParts[2];

                // Admin credentials (stored in frontend)
                const ADMIN_ID = "admin";
                const ADMIN_PASSWORD = "passworduwu"; // Replace with your desired admin password

                try {
                    if (userId === ADMIN_ID && loginPassword === ADMIN_PASSWORD) {
                        // Handle admin login
                        loggedInUser = { id: ADMIN_ID, name: "Admin", role: "admin" }; // Mocked admin user object
                        localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                        appendOutput(`Welcome, ${loggedInUser.name}. You are now logged in as Admin.`);
                        showActions();
                    } else {
                        // Regular user login via backend
                        const loginResponse = await fetch('http://localhost:3000/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ userId, password: loginPassword }),
                        }).then(res => res.json());

                        if (loginResponse?.success) {
                            loggedInUser = loginResponse.user;
                            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                            appendOutput(`Welcome, ${loggedInUser.name}. You are now logged in.`);
                            showActions();
                        } else {
                            appendOutput(`Login failed: ${loginResponse.error || "Unknown error"}`);
                        }
                    }
                } catch (error) {
                    appendOutput('Error during login. Please try again.');
                    console.error("Login Error:", error);
                }
                break;

            case 'logout':
                loggedInUser = null;
                localStorage.removeItem('loggedInUser');
                appendOutput('Logged out successfully.');
                showActions();
                break;

            case 'search_books':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                const query = new URLSearchParams({ title: commandParts[1] }).toString();
                const searchResults = await fetch(`http://localhost:3000/books/search?${query}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                }).then(res => res.json());

                if (searchResults?.length === 0) {
                    appendOutput('No books found matching your search.');
                } else {
                    appendOutput('Search results:');
                    searchResults.forEach(book => {
                        appendOutput(`ID: ${book.book_id}, Title: ${book.Title}, ISBN: ${book.isbn}, Edition: ${book.edition}, Publish Year: ${book.p_year}, Genre: ${book.Genre}, Status: ${book.status}`);
                    });
                }
                break;

            // case 'search_books':
            //     if (!loggedInUser) {
            //         appendOutput('Please login first.');
            //         break;
            //     }
            //     const keyword = commandParts.slice(1).join(' ');
            //     if (keyword.length === 13) {
            //         const searchResults = await fetch('http://localhost:3000/books', {
            //             method: 'POST',
            //             headers: { 'Content-Type': 'application/json' },
            //             body: JSON.stringify({ isbn }),
            //         }).then(res => res.json());
            //     }
            //     if (searchResults?.length === 0) {
            //         appendOutput('No books found matching your search.');
            //     } else {
            //         appendOutput('Search results:');
            //         searchResults.forEach(book => {
            //             appendOutput(`ID: ${book.id}, Title: ${book.title}, Author: ${book.author}`);
            //         });
            //     }
            //     break;

            case 'borrow_books':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                if (commandParts.length !== 2) {
                    appendOutput('Usage: borrow_books [bookID]');
                    break;
                }

                bookId = commandParts[1];

                try {
                    const borrowResponse = await sendRequest('http://localhost:3000/books/borrow', 'POST', { bookId, userId: loggedInUser.id });

                    if (borrowResponse?.book && borrowResponse?.loan) {
                        // Displaying the book and loan details
                        appendOutput(borrowResponse.message);
                        appendOutput(`Book Details: ID=${borrowResponse.book.book_id}, Title=${borrowResponse.book.title}, Status=${borrowResponse.book.status}`);
                        appendOutput(`Loan Details: Loan ID=${borrowResponse.loan.l_id}, Borrow Date=${borrowResponse.loan.l_date}, Status=${borrowResponse.loan.status}`);
                    } else {
                        appendOutput(borrowResponse?.error || 'Failed to borrow book.');
                    }
                } catch (error) {
                    console.error('Error in borrow_books:', error);
                    appendOutput('An unexpected error occurred while borrowing the book.');
                }
                break;

            case 'search_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                const avQuery = new URLSearchParams({ title: commandParts[1] }).toString();
                const avSearchResults = await fetch(`http://localhost:3000/av/search?${avQuery}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                }).then(res => res.json());
                if (avSearchResults?.length === 0) {
                    appendOutput('No audio-visual material found matching your search.');
                } else {
                    appendOutput('Search results:');
                    avSearchResults.forEach(av => {
                        appendOutput(`ID: ${av.av_id}, Title: ${av.Title}, ISAN: ${av.isan}, Publish Year: ${av.p_year}, Duration: ${av.duration}, Status: ${av.status}`);
                    });
                }
                break;

            case 'borrow_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                if (commandParts.length < 2) {
                    appendOutput('Usage: borrow_av [avID]');
                    break;
                }

                avId = commandParts.slice(1).join(' ');

                try {
                    const borrowResponse = await sendRequest('http://localhost:3000/av/borrow', 'POST', { avId, userId: loggedInUser.id });

                    if (borrowResponse?.av && borrowResponse?.loan) {
                        appendOutput(borrowResponse.message);
                        appendOutput(`AV Details: ID=${borrowResponse.av.av_id}, Title=${borrowResponse.av.title}, Status=${borrowResponse.av.status}`);
                        appendOutput(`Loan Details: Loan ID=${borrowResponse.loan.l_id}, Borrow Date=${borrowResponse.loan.l_date}, Status=${borrowResponse.loan.status}`);
                    } else {
                        appendOutput(borrowResponse?.error || 'Failed to borrow av.');
                    }
                } catch (error) {
                    console.error('Error in borrow_av:', error);
                    appendOutput('An unexpected error occurred while borrowing the av.');
                }
                break;
            case 'reserve_discussion_rooms':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                if (commandParts.length < 5) {
                    appendOutput('Usage: reserve_discussion_rooms [discussion_roomID] [startDate startTime] [endDate endTime]');
                    break;
                }

                drId = commandParts[1];

                // Extract start and end date-time inputs
                startTime = `${commandParts[2]} ${commandParts[3]}`;
                endTime = `${commandParts[4]} ${commandParts[5]}`;

                // Check if date-time inputs are valid
                if (isNaN(Date.parse(startTime)) || isNaN(Date.parse(endTime))) {
                    appendOutput('Invalid date-time format. Use: YYYY-MM-DD HH:MM');
                    break;
                }

                try {
                    const reserveResponse = await sendRequest(
                        'http://localhost:3000/discussion_rooms/reserve',
                        'POST',
                        { drId, userId: loggedInUser.id, startTime, endTime }
                    );

                    if (reserveResponse?.reservation) {
                        appendOutput(reserveResponse.message);
                        appendOutput(`Reservation Details: ID=${reserveResponse.reservation.dr_id}, Start=${reserveResponse.reservation.s_time}, End=${reserveResponse.reservation.e_time}`);
                    } else {
                        appendOutput(reserveResponse?.error || 'Failed to reserve discussion room.');
                    }
                } catch (error) {
                    console.error('Error in reserve_discussion_rooms:', error);
                    appendOutput('An unexpected error occurred while reserving the discussion room.');
                }
                break;

            case 'view_discussion_rooms':
                try {
                    const roomsResponse = await sendRequest('http://localhost:3000/discussion_rooms', 'GET');

                    if (roomsResponse?.length > 0) {
                        appendOutput('Available Discussion Rooms:');
                        roomsResponse.forEach(room => {
                            appendOutput(`ID=${room.dr_id}, Status=${room.status}, Capacity=${room.capacity}, Library_ID=${room.library_id}`);
                        });
                    } else {
                        appendOutput('No discussion rooms available.');
                    }
                } catch (error) {
                    console.error('Error in view_discussion_rooms:', error);
                    appendOutput('An unexpected error occurred while fetching discussion rooms.');
                }
                break;
            case 'view_study_rooms':
                try {
                    const studyRoomsResponse = await sendRequest('http://localhost:3000/study_rooms', 'GET');

                    if (studyRoomsResponse?.length > 0) {
                        appendOutput('Available Study Rooms:');
                        studyRoomsResponse.forEach(room => {
                            appendOutput(`ID=${room.sr_id}, Capacity=${room.seat_qty}, Library_ID=${room.library_id}`);
                        });
                    } else {
                        appendOutput('No study rooms available.');
                    }
                } catch (error) {
                    console.error('Error in view_study_rooms:', error);
                    appendOutput('An unexpected error occurred while fetching study rooms.');
                }
                break;
            case 'view_seats':
                if (commandParts.length < 2) {
                    appendOutput('Usage: view_seats [roomID]');
                    break;
                }

                const roomId = commandParts[1];

                try {
                    const seatsResponse = await sendRequest(`http://localhost:3000/study-rooms/${roomId}/seats`, 'GET');

                    if (seatsResponse?.length > 0) {
                        appendOutput(`Seats for Study Room ${roomId}:`);
                        seatsResponse.forEach(seat => {
                            appendOutput(`Seat ID=${seat.seat_id}, Status=${seat.status}`);
                        });
                    } else {
                        appendOutput(`No seats found for Study Room ${roomId}.`);
                    }
                } catch (error) {
                    console.error('Error in view_seats:', error);
                    appendOutput('An unexpected error occurred while fetching seat information.');
                }
                break;

            case 'reserve_study_room':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                if (commandParts.length < 6) {
                    appendOutput('Usage: reserve_study_room [srId] [seatId] [startTime] [endTime]');
                    break;
                }

                srId = commandParts[1];
                seatId = commandParts[2];
                startTime = `${commandParts[3]} ${commandParts[4]}`;
                endTime = `${commandParts[5]} ${commandParts[6]}`;

                // Check if date-time inputs are valid
                if (isNaN(Date.parse(startTime)) || isNaN(Date.parse(endTime))) {
                    appendOutput(`${commandParts[4]} ${commandParts[5]}`);
                    appendOutput('Invalid date-time format. Use: YYYY-MM-DD HH:MM');
                    break;
                }

                try {
                    const reserveResponse = await sendRequest(
                        'http://localhost:3000/study_rooms/reserve',
                        'POST',
                        { srId, userId: loggedInUser.id, seatId, startTime, endTime }
                    );

                    if (reserveResponse?.reservation) {
                        appendOutput(reserveResponse.message);
                        appendOutput(`Reservation Details: ID=${reserveResponse.reservation.sr_id}, Start=${reserveResponse.reservation.s_time}, End=${reserveResponse.reservation.e_time}`);
                    } else {
                        appendOutput(reserveResponse?.error || 'Failed to reserve study room.');
                    }
                } catch (error) {
                    console.error('Error in reserve_study_rooms:', error);
                    appendOutput('An unexpected error occurred while reserving the study room.');
                }
                break;

            case 'submit_wishlist':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }
                if (commandParts.length < 2) {
                    appendOutput('Usage: submit_wishlist [isbn/isan]');
                    break;
                }

                const isbnIsan = commandParts.slice(1).join(' ');
                const currentDate = new Date().toISOString().split('T')[0]; // Get current date in YYYY-MM-DD format

                try {
                    const wishlistResponse = await sendRequest(
                        'http://localhost:3000/wishlist/apply',
                        'POST',
                        { userId: loggedInUser.id, date: currentDate, isbnIsan }
                    );

                    if (wishlistResponse?.wish) {
                        appendOutput(wishlistResponse.message);
                        appendOutput(`Wishlist Details: Date=${wishlistResponse.wish.date}, ISBN/ISAN=${wishlistResponse.wish.isbn_isan}`);
                    } else {
                        appendOutput(wishlistResponse?.error || 'Failed to submit wishlist.');
                    }
                } catch (error) {
                    console.error('Error in submit_wishlist:', error);
                    appendOutput('An unexpected error occurred while submitting the wishlist.');
                }
                break;

            case 'view_wishlist':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                try {
                    const wishlistResponse = await sendRequest(
                        `http://localhost:3000/wishlist?userId=${loggedInUser.id}`,
                        'GET'
                    );

                    if (wishlistResponse?.length > 0) {
                        appendOutput('Your Wishlist:');
                        wishlistResponse.forEach(item => {
                            appendOutput(`Date=${item.date}, ISBN/ISAN=${item.isbn_isan}, Status=${item.status || 'Pending'}`);
                        });
                    } else {
                        appendOutput('Your wishlist is empty.');
                    }
                } catch (error) {
                    console.error('Error in view_wishlist:', error);
                    appendOutput('An unexpected error occurred while fetching your wishlist.');
                }
                break;

            case 'search_active_fairs':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                try {
                    const activeFairsResults = await fetch('http://localhost:3000/fairs/active', {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' },
                    }).then(res => res.json());

                    if (activeFairsResults?.length === 0) {
                        appendOutput('No active book fairs found.');
                    } else {
                        appendOutput('Active book fairs:');
                        activeFairsResults.forEach(fair => {
                            appendOutput(`Name: ${fair.name}, Start Date: ${fair.s_date}, End Date: ${fair.e_date}`);
                        });
                    }
                } catch (error) {
                    console.error("Error fetching active fairs:", error);
                    appendOutput("An error occurred while fetching active book fairs.");
                }
                break;

            case 'search_fair_books':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (commandParts.length < 2) {
                    appendOutput('Usage: search_fair_books [fairName]');
                    break;
                }

                let fairName = commandParts.slice(1).join(' '); // Handles multi-word names

                try {
                    const booksResult = await fetch(`http://localhost:3000/fairs/${encodeURIComponent(fairName)}/books`, {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' },
                    }).then(res => res.json());

                    if (booksResult?.length === 0) {
                        appendOutput(`No books found for the "${fairName}" fair.`);
                    } else {
                        appendOutput(`Books in the "${fairName}" fair:`);
                        booksResult.forEach(book => {
                            appendOutput(`ID: ${book.book_id}, Title: ${book.title}, ISBN: ${book.isbn}, Edition: ${book.edition}, Publish Year: ${book.p_year}, Genre: ${book.Genre}, Status: ${book.status}`);
                        });
                    }
                } catch (error) {
                    console.error("Error fetching books for fair:", error);
                    appendOutput(`An error occurred while fetching books for the "${fairName}" fair.`);
                }
                break;

            case 'new_fair':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length < 4) {
                    appendOutput('Usage: new_fair [Fair Name] [Start Date] [End Date]');
                    break;
                }

                const FairName = commandParts[1]; // Extract fair name
                const s_date = commandParts[2];  // Extract start date
                const e_date = commandParts[3];  // Extract end date
                const books = [];                // Initialize books array

                appendOutput('Enter books for the fair in the following format:');
                appendOutput('Title, book_id');
                appendOutput('Type "done" when you are finished entering books.');

                let doneEnteringBooks = false;

                // Listen for book input dynamically
                while (!doneEnteringBooks) {
                    const bookInput = await getInput(); // Custom function to fetch user input
                    if (bookInput.toLowerCase() === 'done') {
                        doneEnteringBooks = true;
                    } else {
                        const bookParts = bookInput.split(',').map(part => part.trim());
                        if (bookParts.length !== 2) {
                            appendOutput('Invalid book format. Please provide all fields:');
                            appendOutput('Title, book_id');
                        } else {
                            const [title, isbn, edition, publishYear, genre, status] = bookParts;
                            books.push({ title, isbn, edition, p_year: publishYear, genre, status });
                            appendOutput(`Added book: ${title}`);
                        }
                    }
                }

                try {
                    const response = await fetch('http://localhost:3000/newFair', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name: FairName, s_date, e_date, books }),
                    }).then(res => res.json());

                    if (response?.message) {
                        appendOutput(response.message);
                        appendOutput(`Rows updated: ${response.updatedRows || 0}`);
                    } else {
                        appendOutput('Failed to add new fair. Please try again.');
                    }
                } catch (error) {
                    console.error('Error adding new fair:', error);
                    appendOutput('An error occurred while adding the new fair.');
                }
                break;

            case 'new_book':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 8) {
                    appendOutput('Usage: new_book [title] [isbn] [edition] [publish_year] [genre] [status] [author]');
                    break;
                }
                title = commandParts [1];
                isbn = commandParts[2];
                edition = commandParts[3];
                publishYear = commandParts[4];
                genre = commandParts[5];
                status = commandParts[6];
                author = commandParts[7];
                //new_book MyAss 1234567890123 1 2024 erotic 在架 妳媽
                appendOutput(edition);
                try {
                const addBookResponse = await sendRequest(
                    'http://localhost:3000/newBook',
                    'POST',
                    { title, isbn, edition, publishYear, genre, status, author },
                );

                    if (addBookResponse?.message) {
                        appendOutput(addBookResponse.message);
                        appendOutput(`Updated Rows: ${addBookResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(addBookResponse?.error || 'Failed to add new book.');
                    }
                } catch (error) {
                    console.error('Error in new_book:', error);
                    appendOutput('An unexpected error occurred while adding the book.');
                }
                break;

            case 'new_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 7) {
                    appendOutput('Usage: new_av [title] [isan] [status] [publishYear] [duration] [author]');
                    break;
                }
                title = commandParts [1];
                isan = commandParts[2];
                status = commandParts[3];
                publishYear = commandParts[4];
                duration = commandParts[5];
                author = commandParts[6];
                appendOutput(author);
                //new_av MyAss 1234567890123 在架 2024 01:02:03 妳媽
                try {
                    const addAVResponse = await sendRequest(
                        'http://localhost:3000/newAV',
                        'POST',
                        { title, isan, status, p_year: publishYear, duration, author },
                    );

                    if (addAVResponse?.message) {
                        appendOutput(addAVResponse.message);
                        appendOutput(`Updated Rows: ${addAVResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(addAVResponse?.error || 'Failed to add new audio-visual material.');
                    }
                } catch (error) {
                    console.error('Error in new_av:', error);
                    appendOutput('An unexpected error occurred while adding the audio-visual material.');
                }
                break;

            case 'new_book_acq':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 6) {
                    appendOutput('Usage: new_book_acq [acquisitionDate] [status] [isbn] [cost] [supplier]');
                    break;
                }

                [acquisitionDate, status, isbn, cost, supplier] = commandParts.slice(1);

                try {
                    const addBookAcqResponse = await sendRequest(
                        'http://localhost:3000/newBookAcq',
                        'POST',
                        { a_date: acquisitionDate, status, isbn, cost, supplier },
                    );

                    if (addBookAcqResponse?.message) {
                        appendOutput(addBookAcqResponse.message);
                        appendOutput(`Updated Rows: ${addBookAcqResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(addBookAcqResponse?.error || 'Failed to add new book acquisition.');
                    }
                } catch (error) {
                    console.error('Error in new_book_acq:', error);
                    appendOutput('An unexpected error occurred while adding the book acquisition.');
                }
                break;

            case 'new_av_acq':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 6) {
                    appendOutput('Usage: new_av_acq [acquisitionDate] [status] [isan] [cost] [supplier]');
                    break;
                }

                [acquisitionDate, status, isan, cost, supplier] = commandParts.slice(1);

                try {
                    const addAVAcqResponse = await sendRequest(
                        'http://localhost:3000/newAVAcq',
                        'POST',
                        { a_date: acquisitionDate, status, isan, cost, supplier },
                    );

                    if (addAVAcqResponse?.message) {
                        appendOutput(addAVAcqResponse.message);
                        appendOutput(`Updated Rows: ${addAVAcqResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(addAVAcqResponse?.error || 'Failed to add new AV acquisition.');
                    }
                } catch (error) {
                    console.error('Error in new_av_acq:', error);
                    appendOutput('An unexpected error occurred while adding the AV acquisition.');
                }
                break;

            case 'update_book':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 7) {
                    appendOutput('Usage: update_book [title] [isbn] [edition] [publishYear] [genre] [bookID]');
                    break;
                }

                [title, isbn, edition, publishYear, genre, bookID] = commandParts.slice(1);

                try {
                    const updateBookResponse = await sendRequest(
                        'http://localhost:3000/updateBook',
                        'POST',
                        { title, isbn, edition, p_year: publishYear, genre, book_id: bookID },
                    );

                    if (updateBookResponse?.message) {
                        appendOutput(updateBookResponse.message);
                    } else {
                        appendOutput(updateBookResponse?.error || 'Failed to update book.');
                    }
                } catch (error) {
                    console.error('Error in update_book:', error);
                    appendOutput('An unexpected error occurred while updating the book.');
                }
                break;

            case 'update_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 6) {
                    appendOutput('Usage: update_av [title] [isan] [publishYear] [duration] [avID]');
                    break;
                }

                [title, isan, publishYear, duration, avID] = commandParts.slice(1);

                try {
                    const updateAVResponse = await sendRequest(
                        'http://localhost:3000/updateAV',
                        'PUT',
                        { title, isan, p_year: publishYear, duration, av_id: avID },
                    );

                    if (updateAVResponse?.message) {
                        appendOutput(updateAVResponse.message);
                        appendOutput(`Updated Rows: ${updateAVResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(updateAVResponse?.error || 'Failed to update AV material.');
                    }
                } catch (error) {
                    console.error('Error in update_av:', error);
                    appendOutput('An unexpected error occurred while updating the AV material.');
                }
                break;

            case 'delete_book':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: delete_book [bookID]');
                    break;
                }

                bookID = commandParts[1];

                try {
                    const deleteBookResponse = await sendRequest(
                        'http://localhost:3000/deleteBook',
                        'PUT',
                        { book_id: bookID },
                    );

                    if (deleteBookResponse?.message) {
                        appendOutput(deleteBookResponse.message);
                        appendOutput(`Updated Rows: ${deleteBookResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(deleteBookResponse?.error || 'Failed to delete book.');
                    }
                } catch (error) {
                    console.error('Error in delete_book:', error);
                    appendOutput('An unexpected error occurred while deleting the book.');
                }
                break;

            case 'delete_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: delete_av [avID]');
                    break;
                }

                avID = commandParts[1];

                try {
                    const deleteAVResponse = await sendRequest(
                        'http://localhost:3000/deleteAV',
                        'PUT',
                        { av_id: avID },
                    );

                    if (deleteAVResponse?.message) {
                        appendOutput(deleteAVResponse.message);
                        appendOutput(`Updated Rows: ${deleteAVResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(deleteAVResponse?.error || 'Failed to delete AV material.');
                    }
                } catch (error) {
                    console.error('Error in delete_av:', error);
                    appendOutput('An unexpected error occurred while deleting the AV material.');
                }
                break;

            case 'update_book_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_book_status [status] [bookID]');
                    break;
                }

                [bookStatus, bookID] = commandParts.slice(1);

                try {
                    const updateBookStatusResponse = await sendRequest(
                        'http://localhost:3000/updateBookStatus',
                        'PUT',
                        { status: bookStatus, book_id: bookID },
                    );

                    if (updateBookStatusResponse?.message) {
                        appendOutput(updateBookStatusResponse.message);
                        appendOutput(`Updated Rows: ${updateBookStatusResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(updateBookStatusResponse?.error || 'Failed to update book status.');
                    }
                } catch (error) {
                    console.error('Error in update_book_status:', error);
                    appendOutput('An unexpected error occurred while updating the book status.');
                }
                break;

            case 'update_av_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_av_status [status] [avID]');
                    break;
                }

                [avStatus, avID] = commandParts.slice(1);

                try {
                    const updateAVStatusResponse = await sendRequest(
                        'http://localhost:3000/updateAVStatus',
                        'PUT',
                        { status: avStatus, av_id: avID },
                    );

                    if (updateAVStatusResponse?.message) {
                        appendOutput(updateAVStatusResponse.message);
                        appendOutput(`Updated Rows: ${updateAVStatusResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(updateAVStatusResponse?.error || 'Failed to update AV status.');
                    }
                } catch (error) {
                    console.error('Error in update_av_status:', error);
                    appendOutput('An unexpected error occurred while updating the AV status.');
                }
                break;

            case 'return_book':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: return_book [bookID]');
                    break;
                }

                returnBookID = commandParts[1];

                try {
                    const returnBookResponse = await sendRequest(
                        'http://localhost:3000/returnBook',
                        'PUT',
                        { book_id: returnBookID, u_id: loggedInUser.id },
                    );

                    if (returnBookResponse?.message) {
                        appendOutput(returnBookResponse.message);
                        appendOutput(`Updated Rows: ${returnBookResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(returnBookResponse?.error || 'Failed to return the book.');
                    }
                } catch (error) {
                    console.error('Error in return_book:', error);
                    appendOutput('An unexpected error occurred while returning the book.');
                }
                break;

            case 'return_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: return_av [avID]');
                    break;
                }

                returnAVID = commandParts[1];

                try {
                    const returnAVResponse = await sendRequest(
                        'http://localhost:3000/returnAV',
                        'PUT',
                        { av_id: returnAVID, u_id: loggedInUser.id },
                    );

                    if (returnAVResponse?.message) {
                        appendOutput(returnAVResponse.message);
                        appendOutput(`Updated Rows: ${returnAVResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(returnAVResponse?.error || 'Failed to return the AV material.');
                    }
                } catch (error) {
                    console.error('Error in return_av:', error);
                    appendOutput('An unexpected error occurred while returning the AV material.');
                }
                break;

            case 'update_overdue_book_loans':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                try {
                    const overdueBookLoanResponse = await sendRequest(
                        'http://localhost:3000/updateOverdueBookLoan',
                        'PUT'
                    );

                    if (overdueBookLoanResponse?.message) {
                        appendOutput(overdueBookLoanResponse.message);
                        appendOutput(`Updated Rows: ${overdueBookLoanResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(overdueBookLoanResponse?.error || 'Failed to update overdue book loans.');
                    }
                } catch (error) {
                    console.error('Error in update_overdue_book_loans:', error);
                    appendOutput('An unexpected error occurred while updating overdue book loans.');
                }
                break;

            case 'update_overdue_av_loans':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                try {
                    const overdueAVLoanResponse = await sendRequest(
                        'http://localhost:3000/updateOverDueAVLoan',
                        'PUT'
                    );

                    if (overdueAVLoanResponse?.message) {
                        appendOutput(overdueAVLoanResponse.message);
                        appendOutput(`Updated Rows: ${overdueAVLoanResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(overdueAVLoanResponse?.error || 'Failed to update overdue AV loans.');
                    }
                } catch (error) {
                    console.error('Error in update_overdue_av_loans:', error);
                    appendOutput('An unexpected error occurred while updating overdue AV loans.');
                }
                break;

            case 'rating_book':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (commandParts.length !== 4) {
                    appendOutput('Usage: rating_book [rating] [book_id] [user_id]');
                    break;
                }

                rating = commandParts[1];
                bookId = commandParts[2];
                userId = commandParts[3];

                try {
                    const ratingBookResponse = await sendRequest(
                        'http://localhost:3000/ratingBook',
                        'PUT',
                        { rating, book_id: bookId, u_id: userId }
                    );

                    if (ratingBookResponse?.message) {
                        appendOutput(ratingBookResponse.message);
                        appendOutput(`Updated Rows: ${ratingBookResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(ratingBookResponse?.error || 'Failed to rate the book.');
                    }
                } catch (error) {
                    console.error('Error in rating_book:', error);
                    appendOutput('An unexpected error occurred while rating the book.');
                }
                break;

            case 'rating_av':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (commandParts.length !== 4) {
                    appendOutput('Usage: rating_av [rating] [av_id] [user_id]');
                    break;
                }

                avRating = commandParts[1];
                avId = commandParts[2];
                avUserId = commandParts[3];

                try {
                    const ratingAVResponse = await sendRequest(
                        'http://localhost:3000/ratingAV',
                        'PUT',
                        { rating: avRating, av_id: avId, u_id: avUserId }
                    );

                    if (ratingAVResponse?.message) {
                        appendOutput(ratingAVResponse.message);
                        appendOutput(`Updated Rows: ${ratingAVResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(ratingAVResponse?.error || 'Failed to rate the AV.');
                    }
                } catch (error) {
                    console.error('Error in rating_av:', error);
                    appendOutput('An unexpected error occurred while rating the AV.');
                }
                break;

            case 'update_fair_start_date':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_fair_start_date [fair_id] [start_date]');
                    break;
                }

                fairId = commandParts[1];
                startDate = commandParts[2];

                try {
                    const updateFairStartDateResponse = await sendRequest(
                        'http://localhost:3000/updateFairStartDate',
                        'PUT',
                        { fair_id: fairId, s_date: startDate }
                    );

                    if (updateFairStartDateResponse?.message) {
                        appendOutput(updateFairStartDateResponse.message);
                        appendOutput(`Updated Rows: ${updateFairStartDateResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(updateFairStartDateResponse?.error || 'Failed to update fair start date.');
                    }
                } catch (error) {
                    console.error('Error in update_fair_start_date:', error);
                    appendOutput('An unexpected error occurred while updating the fair start date.');
                }
                break;

            case 'update_fair_end_date':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_fair_end_date [fair_id] [end_date]');
                    break;
                }

                fairEndId = commandParts[1];
                endDate = commandParts[2];

                try {
                    const updateFairEndDateResponse = await sendRequest(
                        'http://localhost:3000/updateFairEndDate',
                        'PUT',
                        { fair_id: fairEndId, e_date: endDate }
                    );

                    if (updateFairEndDateResponse?.message) {
                        appendOutput(updateFairEndDateResponse.message);
                        appendOutput(`Updated Rows: ${updateFairEndDateResponse.updatedRows || 0}`);
                    } else {
                        appendOutput(updateFairEndDateResponse?.error || 'Failed to update fair end date.');
                    }
                } catch (error) {
                    console.error('Error in update_fair_end_date:', error);
                    appendOutput('An unexpected error occurred while updating the fair end date.');
                }
                break;

            case 'get_book_loans_by_user':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: get_book_loans_by_user [user_id]');
                    break;
                }

                userId = commandParts[1];

                try {
                    const getBookLoansResponse = await sendRequest(
                        `http://localhost:3000/getBookLoansByUser?u_id=${userId}`,
                        'GET'
                    );

                    if (getBookLoansResponse?.length > 0) {
                        appendOutput('Book loan records for user:');
                        getBookLoansResponse.forEach(loan => {
                            appendOutput(`Book ID: ${loan.book_id}, Loan Date: ${loan.loan_date}, Due Date: ${loan.due_date}`);
                        });
                    } else {
                        appendOutput('No book loans found for this user.');
                    }
                } catch (error) {
                    console.error('Error in get_book_loans_by_user:', error);
                    appendOutput('An unexpected error occurred while fetching book loans.');
                }
                break;

            case 'get_av_loans_by_user':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: get_av_loans_by_user [user_id]');
                    break;
                }

                avUserId = commandParts[1];

                try {
                    const getAVLoansResponse = await sendRequest(
                        `http://localhost:3000/getAVLoansByUser?u_id=${avUserId}`,
                        'GET'
                    );

                    if (getAVLoansResponse?.length > 0) {
                        appendOutput('AV loan records for user:');
                        getAVLoansResponse.forEach(loan => {
                            appendOutput(`AV ID: ${loan.av_id}, Loan Date: ${loan.loan_date}, Due Date: ${loan.due_date}`);
                        });
                    } else {
                        appendOutput('No AV loans found for this user.');
                    }
                } catch (error) {
                    console.error('Error in get_av_loans_by_user:', error);
                    appendOutput('An unexpected error occurred while fetching AV loans.');
                }
                break;

            case 'get_books_by_time':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: get_books_by_time [start_date] [end_date]');
                    break;
                }

                startDate = commandParts[1];
                endDate = commandParts[2];

                try {
                    const getBooksByTimeResponse = await sendRequest(
                        `http://localhost:3000/getBookByTime?start_date=${startDate}&end_date=${endDate}`,
                        'GET'
                    );

                    if (getBooksByTimeResponse?.length > 0) {
                        appendOutput('Books between the specified dates:');
                        getBooksByTimeResponse.forEach(book => {
                            appendOutput(`Book ID: ${book.book_id}, Title: ${book.title}, Date Added: ${book.date_added}`);
                        });
                    } else {
                        appendOutput('No books found within this date range.');
                    }
                } catch (error) {
                    console.error('Error in get_books_by_time:', error);
                    appendOutput('An unexpected error occurred while fetching books.');
                }
                break;

            case 'get_av_by_time':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: get_av_by_time [start_date] [end_date]');
                    break;
                }

                avStartDate = commandParts[1];
                avEndDate = commandParts[2];

                try {
                    const getAVByTimeResponse = await sendRequest(
                        `http://localhost:3000/getAVByTime?start_date=${avStartDate}&end_date=${avEndDate}`,
                        'GET'
                    );

                    if (getAVByTimeResponse?.length > 0) {
                        appendOutput('AVs between the specified dates:');
                        getAVByTimeResponse.forEach(av => {
                            appendOutput(`AV ID: ${av.av_id}, Title: ${av.title}, Date Added: ${av.date_added}`);
                        });
                    } else {
                        appendOutput('No AVs found within this date range.');
                    }
                } catch (error) {
                    console.error('Error in get_av_by_time:', error);
                    appendOutput('An unexpected error occurred while fetching AVs.');
                }
                break;

            case 'get_books_by_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: get_books_by_status [status]');
                    break;
                }

                status = commandParts[1];

                try {
                    const getBooksByStatusResponse = await sendRequest(
                        `http://localhost:3000/getBookByStatus?status=${status}`,
                        'GET'
                    );

                    if (getBooksByStatusResponse?.length > 0) {
                        appendOutput(`Books with status '${status}':`);
                        getBooksByStatusResponse.forEach(book => {
                            appendOutput(`Book ID: ${book.book_id}, Title: ${book.title}, Status: ${book.status}`);
                        });
                    } else {
                        appendOutput(`No books found with status '${status}'.`);
                    }
                } catch (error) {
                    console.error('Error in get_books_by_status:', error);
                    appendOutput('An unexpected error occurred while fetching books.');
                }
                break;

            case 'get_av_by_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 2) {
                    appendOutput('Usage: get_av_by_status [status]');
                    break;
                }

                avStatus = commandParts[1];

                try {
                    const getAVByStatusResponse = await sendRequest(
                        `http://localhost:3000/getAVByStatus?status=${avStatus}`,
                        'GET'
                    );

                    if (getAVByStatusResponse?.length > 0) {
                        appendOutput(`AVs with status '${avStatus}':`);
                        getAVByStatusResponse.forEach(av => {
                            appendOutput(`AV ID: ${av.av_id}, Title: ${av.title}, Status: ${av.status}`);
                        });
                    } else {
                        appendOutput(`No AVs found with status '${avStatus}'.`);
                    }
                } catch (error) {
                    console.error('Error in get_av_by_status:', error);
                    appendOutput('An unexpected error occurred while fetching AVs.');
                }
                break;

            case 'get_fixing_discussion_room':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                try {
                    const getFixingDiscussionRoomResponse = await sendRequest(
                        'http://localhost:3000/getFixingDiscussionRoom',
                        'GET'
                    );

                    if (getFixingDiscussionRoomResponse?.length > 0) {
                        appendOutput('Fixing Discussion Rooms:');
                        getFixingDiscussionRoomResponse.forEach(room => {
                            appendOutput(`Room ID: ${room.room_id}, Room Name: ${room.room_name}, Status: ${room.status}`);
                        });
                    } else {
                        appendOutput('No fixing discussion rooms found.');
                    }
                } catch (error) {
                    console.error('Error in get_fixing_discussion_room:', error);
                    appendOutput('An unexpected error occurred while fetching the fixing discussion rooms.');
                }
                break;

            case 'get_fixing_seats':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                try {
                    const getFixingSeatsResponse = await sendRequest(
                        'http://localhost:3000/getFixingSeats',
                        'GET'
                    );

                    if (getFixingSeatsResponse?.length > 0) {
                        appendOutput('Fixing Seats:');
                        getFixingSeatsResponse.forEach(seat => {
                            appendOutput(`Seat ID: ${seat.seat_id}, Seat Name: ${seat.seat_name}, Status: ${seat.status}`);
                        });
                    } else {
                        appendOutput('No fixing seats found.');
                    }
                } catch (error) {
                    console.error('Error in get_fixing_seats:', error);
                    appendOutput('An unexpected error occurred while fetching the fixing seats.');
                }
                break;

            case 'update_discussion_room_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_discussion_room_status [status] [room_id]');
                    break;
                }

                status  = commandParts[1];
                room_id  = commandParts[2];

                try {
                    const updateDiscussionRoomStatusResponse = await sendRequest(
                        'http://localhost:3000/updateDiscussionRoomStatus',
                        'PUT',
                        { status, room_id }
                    );

                    if (updateDiscussionRoomStatusResponse?.updatedRows > 0) {
                        appendOutput('Discussion room status updated successfully.');
                    } else {
                        appendOutput('Failed to update discussion room status.');
                    }
                } catch (error) {
                    console.error('Error in update_discussion_room_status:', error);
                    appendOutput('An unexpected error occurred while updating the discussion room status.');
                }
                break;

            case 'update_seats_status':
                if (!loggedInUser) {
                    appendOutput('Please login first.');
                    break;
                }

                if (loggedInUser.role !== 'admin') {
                    appendOutput('Unauthorized action.');
                    break;
                }

                if (commandParts.length !== 3) {
                    appendOutput('Usage: update_seats_status [status] [seat_id]');
                    break;
                }

                status = commandParts[1];
                seat_id = commandParts[2];

                try {
                    const updateSeatsStatusResponse = await sendRequest(
                        'http://localhost:3000/updateSeatsStatus',
                        'PUT',
                        { status, seat_id }
                    );

                    if (updateSeatsStatusResponse?.updatedRows > 0) {
                        appendOutput('Seat status updated successfully.');
                    } else {
                        appendOutput('Failed to update seat status.');
                    }
                } catch (error) {
                    console.error('Error in update_seats_status:', error);
                    appendOutput('An unexpected error occurred while updating the seat status.');
                }
                break;

            default:
                appendOutput('Unknown command. Type an action to perform.');
                break;
        }
    }

    async function sendRequest(endpoint, method, data) {
        try {
            const response = await fetch(endpoint, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: data ? JSON.stringify(data) : null,
            });
            return await response.json();
        } catch (error) {
            appendOutput('Error communicating with the server.');
            console.error('Request Error:', error);
        }
    }

    commandInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            const command = commandInput.value.trim();
            appendOutput(`> ${command}`);
            processCommand(command);
            commandInput.value = '';
        }
    });
    showActions();

    // Function to get user input
    async function getInput(prompt = 'Enter books for the fair in the following format:\n' +
    'Title, book_id\n' +
    'Type "done" when you are finished entering books.') {
        return new Promise(resolve => {
            const input = window.prompt(prompt);
            resolve(input.trim());
        });
    }
</script>

</body>
</html>
